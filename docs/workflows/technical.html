<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/favicon.png"><title>Workflow under the hood | MXTR Dashboard Documentation</title><meta name="description" content="Core user dashboard project UI documentation">
    <link rel="modulepreload" href="/core-user-dash-docs/assets/app.a442214b.js"><link rel="modulepreload" href="/core-user-dash-docs/assets/technical.html.157f7fe6.js"><link rel="modulepreload" href="/core-user-dash-docs/assets/simplest_workflow.432b9354.js"><link rel="modulepreload" href="/core-user-dash-docs/assets/technical.html.8a93d2a5.js"><link rel="prefetch" href="/core-user-dash-docs/assets/index.html.8fa5fd5f.js"><link rel="prefetch" href="/core-user-dash-docs/assets/index.html.37d0ed92.js"><link rel="prefetch" href="/core-user-dash-docs/assets/index.html.892ee896.js"><link rel="prefetch" href="/core-user-dash-docs/assets/connections.html.22f5aade.js"><link rel="prefetch" href="/core-user-dash-docs/assets/index.html.c81f9c3d.js"><link rel="prefetch" href="/core-user-dash-docs/assets/sectionMenu.html.917f2edb.js"><link rel="prefetch" href="/core-user-dash-docs/assets/sectionModals.html.c7e6cfa3.js"><link rel="prefetch" href="/core-user-dash-docs/assets/sections.html.3c02cf9f.js"><link rel="prefetch" href="/core-user-dash-docs/assets/index.html.20092298.js"><link rel="prefetch" href="/core-user-dash-docs/assets/404.html.c038a05a.js"><link rel="prefetch" href="/core-user-dash-docs/assets/index.html.11523c19.js"><link rel="prefetch" href="/core-user-dash-docs/assets/index.html.d824b2c0.js"><link rel="prefetch" href="/core-user-dash-docs/assets/index.html.4c191e3f.js"><link rel="prefetch" href="/core-user-dash-docs/assets/connections.html.94f2291d.js"><link rel="prefetch" href="/core-user-dash-docs/assets/index.html.34b4f8b1.js"><link rel="prefetch" href="/core-user-dash-docs/assets/sectionMenu.html.e6b04a0a.js"><link rel="prefetch" href="/core-user-dash-docs/assets/sectionModals.html.5dde31fd.js"><link rel="prefetch" href="/core-user-dash-docs/assets/sections.html.43aa45b2.js"><link rel="prefetch" href="/core-user-dash-docs/assets/index.html.9c2fdbd8.js"><link rel="prefetch" href="/core-user-dash-docs/assets/404.html.a9e6e8c8.js">
    <link rel="stylesheet" href="/core-user-dash-docs/assets/style.2c0c73eb.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/core-user-dash-docs/" class=""><img class="logo" src="/core-user-dash-docs/images/logo.png" alt="MXTR Dashboard Documentation"><span class="site-name can-hide">MXTR Dashboard Documentation</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/core-user-dash-docs/" class="" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Workflows"><span class="title">Workflows</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Workflows"><span class="title">Workflows</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/core-user-dash-docs/workflows" class="router-link-active" aria-label="What is Workflow?"><!--[--><!--]--> What is Workflow? <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/core-user-dash-docs/workflows/sections.html" class="" aria-label="Workflow Sections (Activities)"><!--[--><!--]--> Workflow Sections (Activities) <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/core-user-dash-docs/workflows/sectionMenu.html" class="" aria-label="Section Menu"><!--[--><!--]--> Section Menu <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/core-user-dash-docs/workflows/sectionModals.html" class="" aria-label="Section Modals"><!--[--><!--]--> Section Modals <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/core-user-dash-docs/workflows/connections.html" class="" aria-label="Connections"><!--[--><!--]--> Connections <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/core-user-dash-docs/workflows/technical.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Workflow under the hood"><!--[--><!--]--> Workflow under the hood <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/core-user-dash-docs/email-editor" class="" aria-label="Email Editor"><!--[--><!--]--> Email Editor <!--[--><!--]--></a></div><div class="navbar-item"><a href="/core-user-dash-docs/lead-lists" class="" aria-label="Lead Lists"><!--[--><!--]--> Lead Lists <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/core-user-dash-docs/" class="" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Workflows"><span class="title">Workflows</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Workflows"><span class="title">Workflows</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/core-user-dash-docs/workflows" class="router-link-active" aria-label="What is Workflow?"><!--[--><!--]--> What is Workflow? <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/core-user-dash-docs/workflows/sections.html" class="" aria-label="Workflow Sections (Activities)"><!--[--><!--]--> Workflow Sections (Activities) <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/core-user-dash-docs/workflows/sectionMenu.html" class="" aria-label="Section Menu"><!--[--><!--]--> Section Menu <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/core-user-dash-docs/workflows/sectionModals.html" class="" aria-label="Section Modals"><!--[--><!--]--> Section Modals <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/core-user-dash-docs/workflows/connections.html" class="" aria-label="Connections"><!--[--><!--]--> Connections <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/core-user-dash-docs/workflows/technical.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Workflow under the hood"><!--[--><!--]--> Workflow under the hood <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/core-user-dash-docs/email-editor" class="" aria-label="Email Editor"><!--[--><!--]--> Email Editor <!--[--><!--]--></a></div><div class="navbar-item"><a href="/core-user-dash-docs/lead-lists" class="" aria-label="Lead Lists"><!--[--><!--]--> Lead Lists <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Workflow under the hood <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/core-user-dash-docs/workflows/technical.html#render-process" class="router-link-active router-link-exact-active sidebar-item" aria-label="Render process"><!--[--><!--]--> Render process <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/core-user-dash-docs/workflows/technical.html#backed-requirements" class="router-link-active router-link-exact-active sidebar-item" aria-label="Backed requirements"><!--[--><!--]--> Backed requirements <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/core-user-dash-docs/workflows/technical.html#workflow-instance-and-workflow-definition" class="router-link-active router-link-exact-active sidebar-item" aria-label="Workflow instance and Workflow definition"><!--[--><!--]--> Workflow instance and Workflow definition <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="page-title" tabindex="-1"><a class="header-anchor" href="#page-title" aria-hidden="true">#</a> Workflow under the hood</h1><p>Workflow is a number of &quot;Action items&quot; which can be executed one by one for concrete users (Leads). Workflows exist to automate manual routine work. For example, we can set up sending email for each new created Lead in out platform, instead of doing it manually. The &quot;Schema&quot; for such action can look like this:</p><p><img src="/core-user-dash-docs/assets/simplest_workflow.2f0d6d5a.png" alt="Simplest Workflow"></p><p>Visually Workflow is a schema with &quot;items&quot; that is connected by vertical and horizontal &quot;lines&quot;, practically &quot;items&quot; - is <a href="/core-user-dash-docs/workflows/sections.html" class="">Activities</a> and &quot;lines&quot; - is <a href="/core-user-dash-docs/workflows/connections.html" class="">Connections</a>. In other words Workflow is a number of Activities and Connections. Vuex store contains two corresponding states: <code>activities</code> and <code>connections</code> (<code>src/store/modules/workflow.js</code>), these states always contains actual information for current Workflow, so when user saves the progress we grab data from <code>activities</code> and <code>connections</code> to pass it to the request.</p><h2 id="render-process" tabindex="-1"><a class="header-anchor" href="#render-process" aria-hidden="true">#</a> Render process</h2><p>Let&#39;s review the process of Workflow rendering step by step. Let&#39;s imagine that we already have saved workflow and trying to open it in &quot;Edit Workflow Page&quot;.</p><p>First thing we do is request Workflow data using <code>workflowId</code> from the url (url for workflow is: <code>&#39;/workflows/:id/edit&#39;</code> in vue router - <code>src/router.js</code>). We do this request call in &#39;mounted&#39; hook inside <code>Workflow.vue</code> component (<code>src/views/workflow/Workflow.vue</code>).</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">...</span>
    <span class="token keyword">async</span> <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isLoading <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;clearActivities&#39;</span><span class="token punctuation">)</span> <span class="token comment">// clear for activities</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;clearConnections&#39;</span><span class="token punctuation">)</span> <span class="token comment">// clear for connections</span>
    
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">&#39;getWorkflow&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token comment">// get workflow data</span>
        <span class="token punctuation">}</span>
    
        <span class="token keyword">this</span><span class="token punctuation">.</span>isLoading <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderWorkflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// render workflow</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addWheelEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// add wheel event - scroll on canvas</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;resize&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>updateWorkflowContainerSize<span class="token punctuation">)</span> <span class="token comment">// resize listenner</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Analysing code above we can highlight next important steps in &quot;Workflow rendering&quot; process:</p><ol><li>clear existing <code>activities</code> and <code>connections</code> states</li><li>request for workflow data by &quot;id&quot; via <code>getWorkflow</code> vuex action dispatch (set <code>activities</code> and <code>connections</code>)</li><li>call <code>renderWorkflow()</code> method of the <code>workflow.js</code> mixin</li><li>add wheel event on canvas</li><li>add resize window listener</li></ol><p>With first and second steps everything is clear, but what happens inside <code>renderWorkflow</code>? Here we have a deal with &quot;draw process&quot; (which is described in <a href="/core-user-dash-docs/workflows/sections.html#activity-draw-process" class="">&quot;Activity Draw process&quot;</a>). For now, it is enough to understand this process as &quot;Draw a workflow schema based on current <code>activities</code> and <code>connections</code>&quot;.</p><p>Fourth step adds &quot;scroll listener&quot; on canvas container element to allow moving the &quot;Workflow Schema&quot; via mouse wheel or touchpad.</p><p>The last &quot;add resize window listener&quot; step is needed to have a correct and actual sizes of the canvas element to make correct calculation for positions and sizes of new created sections and for other items that draws inside canvas.</p><h2 id="backed-requirements" tabindex="-1"><a class="header-anchor" href="#backed-requirements" aria-hidden="true">#</a> Backed requirements</h2><p>Except <code>connections</code> and <code>activities</code> the backend requires from us couple of other properties, lets review and explain each of them.</p><p>The entity of the workflow (<a href="#workflow-instance-and-workflow-definition">Workflow definition</a>) for typical Workflow can look like this:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> workflowDefinition <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">activities</span><span class="token operator">:</span> Array<span class="token punctuation">,</span>
    <span class="token literal-property property">connections</span><span class="token operator">:</span> Array<span class="token punctuation">,</span>
    <span class="token literal-property property">description</span><span class="token operator">:</span> String <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// not using on the UI now</span>
    <span class="token literal-property property">folderId</span><span class="token operator">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token comment">// id of the folder that this workflow is laying under</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token comment">// workflow id</span>
    <span class="token literal-property property">isDisabled</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span> <span class="token comment">// workflow status, if &quot;false&quot; the workflow is not runnig (will not create any instances), just saves as template</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// workflow name</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Exactly this entity we send and request from the api endpoints, usage of all Workflow endpoints you can find in <code>src/store/modules/workflow.js</code> directory.</p><h2 id="workflow-instance-and-workflow-definition" tabindex="-1"><a class="header-anchor" href="#workflow-instance-and-workflow-definition" aria-hidden="true">#</a> Workflow instance and Workflow definition</h2><p>We already mentioned that workflow can have &quot;Instance&quot; and &quot;Definition&quot;. So You already know that workflow executes for concrete Lead, it means that there is context for each execution of the Workflow.</p><p>Before Workflow starts its execution on the backend side we create a &quot;copy&quot; (&quot;cast&quot; or &quot;mask&quot;) of the Workflow and runs our activities based on this &quot;copy&quot; but not based on the original Workflow object. The &quot;Original Object&quot; here we call <strong>&quot;Workflow Definition&quot;</strong> when &quot;copy&quot; is <strong>&quot;Workflow Instance&quot;</strong></p><p><strong>Reasonable question here is</strong>: why we need to create an Instance for each execution and not just use the Definition for it?</p><p><strong>To answer to this question</strong> let&#39;s review next situation:</p><p>Imagine that you set up the workflow and activate it, let&#39;s say that our workflow starts its execution for some lead, and exactly at this moment you decide to change something in your workflow. So if you made some minor changes then workflow can finish its execution successfully, but what if changes was more significant, and new changes does not match with action that is executes right now, what then can happen with our lead? In second case we definitely got the error.</p><p>So to avoid such issues we need to create the &quot;Workflow Instance&quot; for each execution, that way our execution will work based on workflow copy, that will never be changed during execution process. s</p><p>Using <strong>Workflow Instances</strong> we are available to create some kind of &quot;Log page&quot; for each &quot;Workflow Definition&quot;, this &quot;Logs&quot; are available via next url: <code>&#39;/workflows/:id/logs&#39;</code> where <code>:id</code> is &quot;Definition ID&quot;. This url corresponds to <code>WorkflowLogs.vue</code> component (<code>src/views/workflow/WorkflowLogs.vue</code>).</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: maksim.maliauka@itechart-group.com">maksim-maliauka</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/core-user-dash-docs/assets/app.a442214b.js" defer></script>
  </body>
</html>
