import{_ as c}from"./simplest_workflow.432b9354.js";import{_ as p,r,o as l,c as d,a as e,b as n,t as u,d as t,w as a,e as o}from"./app.18e07e69.js";const h="/core-user-dash-docs/assets/simplest_workflow_connections_example.8878c228.png",k={},v={id:"page-title",tabindex:"-1"},m=e("a",{class:"header-anchor",href:"#page-title","aria-hidden":"true"},"#",-1),y=n("Connection is entity which connects two neighbour "),w=n("Activities"),b=n(". Usually connection connects "),_=n("Fork"),f=n(" or "),g=n("Join"),j=n(" (activities that do not have visual part) with any other Activity (with visual part) or wise versa. But there is no case when we need to connect Join and Fork or Fork and Join. There is also no case when we need to connect Activity with other Activity, usually there is Join or Fork between them."),x=o('<h2 id="connection-entity" tabindex="-1"><a class="header-anchor" href="#connection-entity" aria-hidden="true">#</a> Connection entity</h2><p>Connection entity must contain 3 properties:</p><ul><li><strong>sourceActivityId</strong> - source (parent) activity id</li><li><strong>destinationActivityId</strong> - destination (child) activity id</li><li><strong>outcome</strong> - branch id</li></ul><p>With first and second properties everything is pretty clear, but what is &quot;outcome&quot;?</p><h2 id="outcome" tabindex="-1"><a class="header-anchor" href="#outcome" aria-hidden="true">#</a> outcome</h2><p><code>outcome</code> accepts two values: id (string) of the branch or null. When activity have a single child the <code>outcome</code> property should be <code>null</code> but if there are few child Sections then connections to these Sections must contain unique branch id.</p><h2 id="examples" tabindex="-1"><a class="header-anchor" href="#examples" aria-hidden="true">#</a> Examples</h2><p><img src="'+c+'" alt="Simple workflow"></p><p>On the schema above we have 4 sections,</p><ul><li>Start - <code>start</code></li><li>Lead Created Trigger - <code>trigger</code></li><li>Send Email Activity - <code>activity</code></li><li>Finish section - <code>finish</code></li></ul><p>If you check <code>activities</code> state in vuex you will notify that it contains 5 items, when <code>sections</code> state contains 4, and we have 4 items for <code>connections</code> state. Looks a bit confusing, but let&#39;s explain everything step by step:</p><p>First of all <code>sections</code> state contains only Activities that you see on the screenshot above (activities that have visual part), when <code>activities</code> state must contain all activities that would be saved on the backend side. It means that <code>activities</code> state does not contain <code>start</code> section, but why 5 items there? The thing is that we have two more activities in our workflow, that are not have visual part, but they still must be saved on the backend side, they are <code>Join</code> and <code>Fork</code>.</p>',12),A=n("Each workflow starts from Triggers, there can be a single trigger or number of them, but important moment that for both cases we insert "),q=n("Join"),S=n(' activity after these triggers, as here we can have deal with "multiple connections".'),C=n("Fork"),F=n(" activity appears between "),I=e("code",null,"activity",-1),T=n(" and "),J=e("code",null,"finish",-1),B=n(', as we should pass "Fork" activity after each section that can have more than one child (more the one branch) in the future.'),E=o('<p>Visually we can &quot;insert&quot; our &quot;invisible&quot; activities onto next places:</p><p><img src="'+h+`" alt="Simple workflow"></p><p>So now we know what items we have in <code>activities</code> state, let&#39;s check <code>connection</code> for them.</p><p>So to connect two activities we have to know their ids, lets say that activity id corresponds to activity number from schema above. First connection then should connect <code>trigger</code> and <code>join</code>:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> triggerJoinConnection <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">sourceActivityId</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">destinationActivityId</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token literal-property property">outcome</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>join</code> to <code>activity</code> and <code>activity</code> to <code>fork</code> connections would look like:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> joinActivityConnection <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">sourceActivityId</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token literal-property property">destinationActivityId</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token literal-property property">outcome</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> activityForkConnection <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">sourceActivityId</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token literal-property property">destinationActivityId</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token literal-property property">outcome</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As you can see the rules is pretty simple for reviewed connections, but for the <code>fork</code> to &quot;some section&quot; the connections process is a bit complicated. The thing is that for connections &quot;from Fork&quot; we need to provide <code>outcome</code> property as exactly &quot;Fork&quot; activity allows us to have multiple connections to single activity. In our case we do not have multiple connections after our <code>activity</code>, but we still have to insert <code>Fork</code> after it.</p>`,8),L=n("So "),M=n("Fork"),V=n(" must contain information about its branches - which is "),N=e("code",null,"Branches",-1),W=n(" property inside "),O=e("code",null,"state",-1),R=n(' property, in reality it is simple array of the "Fork branches ids" (these ids generates when user adds new child for '),$=e("code",null,"activity",-1),D=n(" above its fork). Or in other words: once the child section is created we need to create new branch (add new id into "),P=e("code",null,"Branches",-1),U=n(" property) and new connection with this branch in "),z=e("code",null,"outcome",-1),G=n("."),H=o(`<p>In our case lets say we generate new branch with <code>id: &quot;b1&quot;</code>, then connection will look like this:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> forkFinishConnection <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">sourceActivityId</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token literal-property property">destinationActivityId</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token literal-property property">outcome</span><span class="token operator">:</span> <span class="token string">&quot;b1&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="create-connection-process" tabindex="-1"><a class="header-anchor" href="#create-connection-process" aria-hidden="true">#</a> Create connection process</h2>`,3),K=n("Practically new connection creates each time we create new section. Let's review the process of connection generation from the moment when user fill all the required fields in "),Q=n("Section modal"),X=n(' and press "Save" button.'),Y=o(`<p>So once user saves &quot;Section modal&quot; the <code>submitCurrentModal</code> method of the <code>workflow.js</code> mixin triggers (<code>src/mixins/workflow/workflow.js</code>)</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>    <span class="token operator">...</span>
        <span class="token keyword">async</span> <span class="token function">submitCurrentModal</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> template <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> activityTemplate <span class="token operator">=</span> <span class="token keyword">null</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sectionEdit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;updateActivity&#39;</span><span class="token punctuation">,</span> template<span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleModalClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                activityTemplate <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareSection</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>activeSection<span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createActivity</span><span class="token punctuation">(</span>activityTemplate<span class="token punctuation">)</span> <span class="token comment">// we are intersted in this call</span>
            <span class="token punctuation">}</span>
            <span class="token operator">...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We are interested in <code>createActivity</code> call as exactly inside this method of <code>section.js</code> mixin (<code>src/mixins/workflow/section.js</code>) we create new connections for activities. There are lots of code lines in this method, it contains main logic for new activities, forks, joins, fork branches and connections generation. This method is also good enough commented, so you can just read the comments and understand the logic. Inside this method you can find few calls for <code>createActivity</code>, usually it calls when activities that needs to be connected are already created as we need their ids for connection.</p><p>The method is <code>createConnection</code> and it is pretty simple, it returns object which we are already familiar with:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">...</span>
    <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> destination<span class="token punctuation">,</span> branch <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">sourceActivityId</span><span class="token operator">:</span> source<span class="token punctuation">,</span>
            <span class="token literal-property property">destinationActivityId</span><span class="token operator">:</span> destination<span class="token punctuation">,</span>
            <span class="token literal-property property">outcome</span><span class="token operator">:</span> branch<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Summarising all of that the flow for the new activity creation will look like:</p><ul><li>press &quot;save&quot; button on the Section modal</li><li>trigger <code>submitCurrentModal</code> method form <code>workflow.js</code> mixin</li><li>call <code>createSection</code> method from <code>section.js</code> mixin</li><li>call <code>createConnection</code> method from <code>section.js</code> mixin, which returns connection</li><li>add new connection to the <code>connections</code> state</li></ul>`,7);function Z(i,nn){const s=r("RouterLink");return l(),d("div",null,[e("h1",v,[m,n(" "+u(i.$page.title),1)]),e("p",null,[y,t(s,{to:"/workflows/sections.html"},{default:a(()=>[w]),_:1}),b,t(s,{to:"/workflows/sections.html#fork"},{default:a(()=>[_]),_:1}),f,t(s,{to:"/workflows/sections.html#join"},{default:a(()=>[g]),_:1}),j]),x,e("p",null,[A,t(s,{to:"/workflows/sections.html#join"},{default:a(()=>[q]),_:1}),S]),e("p",null,[t(s,{to:"/workflows/sections.html#fork"},{default:a(()=>[C]),_:1}),F,I,T,J,B]),E,e("p",null,[L,t(s,{to:"/workflows/sections.html#fork"},{default:a(()=>[M]),_:1}),V,N,W,O,R,$,D,P,U,z,G]),H,e("p",null,[K,t(s,{to:"/workflows/sectionModals.html"},{default:a(()=>[Q]),_:1}),X]),Y])}const tn=p(k,[["render",Z],["__file","connections.html.vue"]]);export{tn as default};
